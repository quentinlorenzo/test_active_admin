<%# 
  Composant réutilisable pour les graphiques en camembert.
  Paramètres requis :
  - canvas_id: ID du canvas HTML
  - labels: Tableau des étiquettes
  - data: Tableau des valeurs
  - background_colors: Tableau des couleurs
  - title: Titre du graphique
  - metric_name: Nom de la métrique (ex: "impressions", "clics") 
%>
<div class="graph-wrapper">
  <canvas id="<%= canvas_id %>"></canvas>
</div>
<script>
  document.addEventListener('DOMContentLoaded', function() {
    const ctx = document.getElementById('<%= canvas_id %>').getContext('2d');
    new Chart(ctx, {
      type: 'pie',
      data: {
        labels: <%= raw labels.to_json %>,
        datasets: [{
          data: <%= raw data.to_json %>,
          backgroundColor: <%= raw background_colors.to_json %>
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          title: {
            display: true,
            text: '<%= title %>'
          },
          tooltip: {
            callbacks: {
              label: function(context) {
                const value = context.raw;
                const total = context.dataset.data.reduce((a, b) => a + b, 0);
                const percentage = Math.round((value / total) * 100);
                return `${context.label}: ${percentage}% (${value.toLocaleString()} <%= metric_name %>)`;
              }
            }
          },
          datalabels: {
            formatter: (value, ctx) => {
              const total = ctx.dataset.data.reduce((a, b) => a + b, 0);
              const percentage = Math.round((value / total) * 100);
              return `${percentage}%`;
            },
            color: '#fff',
            font: {
              weight: 'bold',
              size: 14
            }
          }
        }
      },
      plugins: [ChartDataLabels]
    });
  });
</script> 